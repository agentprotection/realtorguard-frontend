<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Agent Dashboard | Realtor Guard</title>

  <style>
    :root{
      --navy:#0B2C4F;
      --white:#FFFFFF;
      --border:#E5E7EB;
      --success:#16A34A;
      --danger:#B91C1C;
    }

    body{
      margin:0;
      font-family:Arial,sans-serif;
      background:var(--white);
      color:var(--navy);
    }

    .nav{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 18px;
      border-bottom:1px solid var(--border);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:700;
      cursor:pointer;
    }

    .page{
      max-width:720px;
      margin:0 auto;
      padding:24px;
    }

    h1{
      text-align:center;
      margin:18px 0 8px;
    }

    .muted{
      text-align:center;
      color:#666;
      margin-bottom:18px;
    }

    .card{
      border:1px solid var(--border);
      border-radius:12px;
      padding:16px;
      background:#fff;
      margin-top:16px;
    }

    .label{
      font-size:13px;
      color:#555;
      margin-top:10px;
    }

    .value{
      font-weight:700;
      margin-top:2px;
    }

    .profile{
      display:flex;
      gap:16px;
      align-items:flex-start;
    }

    .avatar{
      width:72px;
      height:72px;
      border-radius:50%;
      background:#e5e7eb;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:28px;
      font-weight:bold;
      color:#555;
      flex-shrink:0;
    }

    .actions{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-top:18px;
    }

    .btn{
      padding:12px;
      border:none;
      border-radius:10px;
      font-size:15px;
      cursor:pointer;
    }

    .btn-success{
      background:var(--success);
      color:var(--white);
    }

    .btn-danger{
      background:var(--danger);
      color:var(--white);
    }

    .empty{
      border:1px dashed var(--border);
      border-radius:12px;
      padding:20px;
      text-align:center;
      color:#666;
    }
  </style>
</head>
<body>

  <div class="nav">
    <div class="brand" onclick="goHome()">üõ°Ô∏è Realtor Guard</div>
  </div>

  <div class="page">
    <h1>Agent Dashboard</h1>
    <p class="muted">Track your observer assignment</p>

    <div id="content"></div>
  </div>

  <script>
    function goHome(){
      window.location.href = "choose-role.html";
    }

    function render(){
      const container = document.getElementById("content");
      const req = JSON.parse(localStorage.getItem("assignmentRequest"));

      if(!req){
        container.innerHTML = `
          <div class="empty">
            No active request.<br/>
            Submit a request to get started.
          </div>
        `;
        return;
      }

      if(req.status === "pending"){
        container.innerHTML = `
          <div class="card">
            <div class="label">Status</div>
            <div class="value">Waiting for observer acceptance</div>
          </div>
        `;
        return;
      }

      if(req.status === "accepted"){
        const observer = req.observer || {
          name: "John Williams",
          vehicle: "Toyota Camry ‚Ä¢ 2021 ‚Ä¢ Black",
          rating: "4.9 ‚òÖ (128 reviews)",
          phone: "5551234567"
        };

        container.innerHTML = `
          <div class="card">
            <div class="label">Status</div>
            <div class="value">Observer Assigned</div>

            <div class="profile" style="margin-top:14px;">
              <div class="avatar">JW</div>

              <div>
                <div class="label">Observer</div>
                <div class="value">${observer.name}</div>

                <div class="label">Vehicle</div>
                <div class="value">${observer.vehicle}</div>

                <div class="label">Rating</div>
                <div class="value">${observer.rating}</div>
              </div>
            </div>

            <div class="actions">
              <button class="btn btn-success" onclick="messageObserver('${observer.phone}')">
                Message Observer (Running Late)
              </button>

              <button class="btn btn-danger" onclick="cancelAssignment()">
                Cancel Assignment
              </button>
            </div>
          </div>
        `;
      }
    }

    function messageObserver(phone){
      const msg = encodeURIComponent(
        "Hi, I‚Äôm running a few minutes late. Thank you for waiting."
      );

      const isMobile = /iPhone|Android/i.test(navigator.userAgent);
      const url = isMobile
        ? `sms:${phone}?&body=${msg}`
        : `mailto:?subject=Realtor Guard Update&body=${msg}`;

      window.location.href = url;
    }

    function cancelAssignment(){
      if(!confirm("Are you sure you want to cancel this assignment?")) return;

      localStorage.removeItem("assignmentRequest");
      alert("Assignment canceled.");
      render();
    }

    render();
  </script>

</body>
</html>     
