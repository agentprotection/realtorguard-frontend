<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Agent Dashboard | Realtor Guard</title>

<style>
:root{
  --navy:#0B2C4F;
  --border:#E5E7EB;
  --success:#16A34A;
  --danger:#B91C1C;
  --muted:#6B7280;
}
body{margin:0;font-family:Arial,sans-serif;color:var(--navy);}
.nav{padding:14px 18px;border-bottom:1px solid var(--border);font-weight:700;}
.page{max-width:920px;margin:auto;padding:24px;}
.card{border:1px solid var(--border);border-radius:14px;padding:16px;margin-top:16px;}
h1{text-align:center;margin:6px 0;}
.muted{text-align:center;color:var(--muted);margin-bottom:20px;}
label{font-size:13px;margin-top:10px;display:block;}
input,select,textarea{
  width:100%;padding:10px;margin-top:6px;
  border-radius:10px;border:1px solid var(--border);
}
textarea{min-height:80px;}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
@media(max-width:720px){.grid{grid-template-columns:1fr;}}
.row{display:flex;gap:10px;flex-wrap:wrap;}
.btn{
  padding:12px 14px;border:none;border-radius:10px;
  font-size:15px;cursor:pointer;
}
.primary{background:var(--navy);color:white;width:100%;}
.success{background:var(--success);color:white;}
.danger{background:var(--danger);color:white;}
.outline{background:white;border:1px solid var(--navy);color:var(--navy);}
.badge{
  display:inline-block;padding:4px 10px;border-radius:999px;
  font-size:12px;border:1px solid var(--border);margin-left:8px;
}
.canceled{opacity:.55;text-decoration:line-through;}
.small{font-size:12px;color:var(--muted);}
</style>
</head>

<body>

<div class="nav">üõ°Ô∏è Realtor Guard ‚Äî Agent Dashboard</div>

<div class="page">
<h1>Agent Dashboard</h1>
<p class="muted">Request observers and manage each property independently</p>

<div id="content"></div>
</div>

<script>
const MAX_PROPERTIES = 3;

const STATES = [
"AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS",
"KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY",
"NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV",
"WI","WY"
];

let propertyCount = 1;

function render(){
  const c = document.getElementById("content");
  const req = JSON.parse(localStorage.getItem("assignmentRequest"));

  if(!req){
    c.innerHTML = requestForm();
    renderProperties();
    return;
  }

  if(req.status === "pending"){
    c.innerHTML = `
      <div class="card">
        <b>Status:</b> Waiting for observer acceptance
        <div class="small">Observers will appear per property once accepted.</div>
        <button class="btn danger" style="margin-top:12px;" onclick="cancelAll()">Cancel All</button>
      </div>`;
    return;
  }

  if(req.status === "accepted"){
    c.innerHTML = req.properties.map((p,i)=>propertyCard(p,i)).join("");
  }
}

function requestForm(){
return `
<div class="card">
<label>Agent Full Name</label>
<input id="agentName"/>

<div id="properties"></div>

<button class="btn outline" onclick="addProperty()">+ Add Property</button>
<button class="btn primary" onclick="submit()">Submit Request</button>

<div class="small">You can add up to 3 properties.</div>
</div>`;
}

function propertyBlock(i){
return `
<div class="card">
<b>Property ${i+1}</b>

<label>Street</label><input id="street${i}">
<label>City</label><input id="city${i}">
<label>State</label>
<select id="state${i}">${STATES.map(s=>`<option>${s}</option>`).join("")}</select>
<label>Zip</label><input id="zip${i}">

<label>Date</label><input type="date" id="date${i}">

<label>Time</label>
<div class="row">
<select id="hour${i}">${[...Array(12)].map((_,h)=>`<option>${h+1}</option>`).join("")}</select>
<select id="min${i}"><option>00</option><option>15</option><option>30</option><option>45</option></select>
<select id="ampm${i}"><option>AM</option><option>PM</option></select>
</div>

${i>0?`<button class="btn danger" onclick="removeProperty(${i})">Delete Property</button>`:""}
</div>`;
}

function propertyCard(p,i){
const canceled = p.status === "canceled";
return `
<div class="card ${canceled?"canceled":""}">
<b>Property ${i+1}</b>
${p.status==="accepted"?'<span class="badge">Accepted</span>':""}
${p.status==="canceled"?'<span class="badge">Canceled</span>':""}

<div class="small">${p.street}, ${p.city}, ${p.state} ${p.zip}</div>
<div class="small">${p.date} @ ${p.time}</div>

${p.observer?`
  <div class="small">
    Observer: <b>${p.observer.name}</b> ‚Ä¢ ${p.observer.vehicle}
  </div>`:""}

${p.status==="accepted"?`
<div class="row" style="margin-top:12px;">
  <button class="btn success" onclick="textObserver(${i})">Text Observer</button>
  <button class="btn danger" onclick="cancelProperty(${i})">Cancel Property</button>
</div>`:""}
</div>`;
}

function renderProperties(){
  const p=document.getElementById("properties");
  p.innerHTML="";
  for(let i=0;i<propertyCount;i++) p.innerHTML+=propertyBlock(i);
}

function addProperty(){
  if(propertyCount>=MAX_PROPERTIES) return alert("Max 3 properties");
  propertyCount++;
  renderProperties();
}

function removeProperty(i){
  propertyCount--;
  renderProperties();
}

function submit(){
  const props=[];
  for(let i=0;i<propertyCount;i++){
    props.push({
      street:street${i}.value,
      city:city${i}.value,
      state:state${i}.value,
      zip:zip${i}.value,
      date:date${i}.value,
      time:`${hour${i}.value}:${min${i}.value} ${ampm${i}.value}`,
      status:"pending"
    });
  }

  localStorage.setItem("assignmentRequest",JSON.stringify({
    agentName:agentName.value,
    status:"pending",
    properties:props
  }));
  render();
}

function textObserver(i){
  const req=JSON.parse(localStorage.getItem("assignmentRequest"));
  const p=req.properties[i];
  const msg=encodeURIComponent(
    `Hi, I‚Äôm running a few minutes late for ${p.street}, ${p.city}.`
  );
  window.location.href=`sms:${p.observer.phone}?&body=${msg}`;
}

function cancelProperty(i){
  if(!confirm("Cancel this property only?")) return;
  const req=JSON.parse(localStorage.getItem("assignmentRequest"));
  req.properties[i].status="canceled";
  localStorage.setItem("assignmentRequest",JSON.stringify(req));
  render();
}

function cancelAll(){
  if(!confirm("Cancel entire request?")) return;
  localStorage.removeItem("assignmentRequest");
  render();
}

render();
</script>
</body>
</html>
