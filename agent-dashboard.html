<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Agent Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#f4f4f4}
.wrap{max-width:900px;margin:auto;padding:16px}
.card{background:#fff;border-radius:14px;padding:16px;margin-top:14px;
box-shadow:0 2px 8px rgba(0,0,0,.08)}
input,select,button{
  width:100%;padding:14px;margin-top:10px;
  border-radius:12px;font-size:16px
}
button{border:none;font-weight:900;background:#111;color:#fff}
.secondary{background:#fff;color:#111;border:1px solid #ccc}
.status{margin-top:8px;font-weight:900}
.pending{color:#6b7280}
.accepted{color:#2563eb}
.inroute{color:#16a34a}
.expired{color:#dc2626}
</style>
</head>

<body>
<div class="wrap">
<h2>Agent Dashboard</h2>

<!-- FORM -->
<div class="card">

  <input id="agentName" placeholder="Agent Name">

  <!-- PROPERTY 1 -->
  <input class="propAddress" placeholder="Property Address">
  <input class="propCity" placeholder="City">
  <input class="propZip" placeholder="ZIP Code">

  <select class="propState">
    <option value="">State</option>
    <option>AL</option><option>AK</option><option>AZ</option><option>AR</option>
    <option>CA</option><option>CO</option><option>CT</option><option>DE</option>
    <option>FL</option><option>GA</option><option>HI</option><option>ID</option>
    <option>IL</option><option>IN</option><option>IA</option><option>KS</option>
    <option>KY</option><option>LA</option><option>ME</option><option>MD</option>
    <option>MA</option><option>MI</option><option>MN</option><option>MS</option>
    <option>MO</option><option>MT</option><option>NE</option><option>NV</option>
    <option>NH</option><option>NJ</option><option>NM</option><option>NY</option>
    <option>NC</option><option>ND</option><option>OH</option><option>OK</option>
    <option>OR</option><option>PA</option><option>RI</option><option>SC</option>
    <option>SD</option><option>TN</option><option>TX</option><option>UT</option>
    <option>VT</option><option>VA</option><option>WA</option><option>WV</option>
    <option>WI</option><option>WY</option>
  </select>

  <!-- EXTRA PROPERTIES -->
  <div id="extraProps"></div>

  <!-- VISIT -->
  <select id="visitType">
    <option value="">Visit Type</option>
    <option>Open House</option>
    <option>Showing</option>
    <option>Other</option>
  </select>

  <input id="date" type="date" placeholder="Date">
  <input id="time" type="time" placeholder="Time">

  <select id="duration">
    <option value="">Duration</option>
    <option>30 minutes</option>
    <option>60 minutes</option>
    <option>90 minutes</option>
    <option>120 minutes</option>
    <option>150 minutes</option>
    <option>180 minutes</option>
    <option>210 minutes</option>
    <option>240 minutes</option>
  </select>

  <!-- ADD PROPERTY MOVED HERE -->
  <button class="secondary" onclick="addProperty()">Add Property</button>

  <button onclick="submitRequest()">Request Observer</button>
</div>

<!-- REQUEST LIST -->
<div class="card">
  <div id="list"></div>
</div>

</div>

<script>
const REQ_KEY="rg_agent_requests_v1";
const STATUS_KEY="rg_request_status_v3";

const loadReq=()=>JSON.parse(localStorage.getItem(REQ_KEY))||[];
const saveReq=r=>localStorage.setItem(REQ_KEY,JSON.stringify(r));
const loadStatus=()=>JSON.parse(localStorage.getItem(STATUS_KEY))||{};

let propCount=1;

function addProperty(){
  if(propCount>=3) return;
  propCount++;
  const d=document.createElement("div");
  d.innerHTML=`
    <input class="propAddress" placeholder="Property Address">
    <input class="propCity" placeholder="City">
    <input class="propZip" placeholder="ZIP Code">
    <select class="propState">
      <option value="">State</option>
      <option>AL</option><option>AK</option><option>AZ</option><option>AR</option>
      <option>CA</option><option>CO</option><option>CT</option><option>DE</option>
      <option>FL</option><option>GA</option><option>HI</option><option>ID</option>
      <option>IL</option><option>IN</option><option>IA</option><option>KS</option>
      <option>KY</option><option>LA</option><option>ME</option><option>MD</option>
      <option>MA</option><option>MI</option><option>MN</option><option>MS</option>
      <option>MO</option><option>MT</option><option>NE</option><option>NV</option>
      <option>NH</option><option>NJ</option><option>NM</option><option>NY</option>
      <option>NC</option><option>ND</option><option>OH</option><option>OK</option>
      <option>OR</option><option>PA</option><option>RI</option><option>SC</option>
      <option>SD</option><option>TN</option><option>TX</option><option>UT</option>
      <option>VT</option><option>VA</option><option>WA</option><option>WV</option>
      <option>WI</option><option>WY</option>
    </select>
  `;
  extraProps.appendChild(d);
}

function submitRequest(){
  if(!agentName.value || !document.querySelector(".propAddress").value){
    alert("Complete required fields");
    return;
  }

  const reqs=loadReq();
  reqs.push({
    id:Date.now().toString(),
    address:document.querySelector(".propAddress").value,
    date:date.value,
    time:time.value
  });
  saveReq(reqs);
  render();
}

function resolveStatus(r){
  const s=loadStatus()[r.id];
  const sched=new Date(`${r.date}T${r.time}`);
  const now=Date.now();

  if(s?.status==="in_route") return{t:"In Route",c:"inroute"};
  if(s?.status==="accepted") return{t:"Accepted",c:"accepted"};
  if(now>sched) return{t:"Expired",c:"expired"};
  return{t:"Pending",c:"pending"};
}

function deleteRequest(id){
  saveReq(loadReq().filter(r=>r.id!==id));
  render();
}

function render(){
  list.innerHTML="";
  loadReq().forEach(r=>{
    const s=resolveStatus(r);
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`
      <b>${r.address}</b>
      <div>${r.date} ${r.time}</div>
      <div class="status ${s.c}">${s.t}</div>
      ${s.t==="Expired"
        ? `<button class="secondary" onclick="deleteRequest('${r.id}')">Delete</button>`
        : ``}
    `;
    list.appendChild(c);
  });
}

render();
</script>
</body>
</html>
