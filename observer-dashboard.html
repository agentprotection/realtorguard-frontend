
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Observer Dashboard | Realtor Guard</title>

<style>
* {
  box-sizing: border-box;
  font-family: Arial, Helvetica, sans-serif;
}

body {
  margin: 0;
  background: #ffffff;
  display: flex;
  justify-content: center;
}

.page {
  width: 100%;
  max-width: 420px;
  padding: 32px 20px 60px;
  text-align: center;
}

.logo {
  width: 180px;
  margin: 0 auto 24px;
}

h1 {
  margin-bottom: 12px;
}

.card {
  background: #f7f9fc;
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
  text-align: left;
}

.card strong {
  display: block;
  margin-top: 6px;
}

button {
  width: 100%;
  padding: 14px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
  cursor: pointer;
}

.accept {
  background: #0b1f3a;
  color: #fff;
  margin-top: 12px;
}

.decline {
  background: #ccc;
  margin-top: 8px;
}

.start {
  background: #198754;
  color: #fff;
  margin-top: 12px;
}

.logout {
  margin-top: 32px;
  font-size: 14px;
  cursor: pointer;
  color: #555;
  text-align: center;
}
</style>
</head>

<body>
<div class="page">

<img src="logo.png" class="logo" alt="Realtor Guard Logo" />
<h1>Observer Dashboard</h1>

<div id="content"></div>

<div class="logout" onclick="logout()">Log out</div>

</div>

<script>
// AUTH GUARD
if (localStorage.getItem("rg_observer_logged_in") !== "true") {
  window.location.href = "observer-auth.html";
}

// MOCK PROFILE CHECK (replace later with real profile)
const observerProfileComplete = localStorage.getItem("rg_observer_profile_complete") === "true";

// ACTIVE ASSIGNMENT
const activeAssignment = JSON.parse(localStorage.getItem("rg_active_assignment") || "null");

// OPEN REQUEST (from agent)
const openRequest = JSON.parse(localStorage.getItem("rg_active_request") || "null");

const content = document.getElementById("content");

// ---------- RENDER ----------
if (activeAssignment) {
  renderAssignment(activeAssignment);
} else if (openRequest) {
  renderRequest(openRequest);
} else {
  content.innerHTML = "<p>No open requests available.</p>";
}

// ---------- FUNCTIONS ----------
function renderRequest(req) {
  content.innerHTML = `
    <div class="card">
      <strong>Agent:</strong> ${req.agentName || "â€”"}
      <strong>Address:</strong> ${req.address}, ${req.city}, ${req.state} ${req.zip}
      <strong>Date:</strong> ${req.date}
      <strong>Time:</strong> ${req.time}
      <strong>Duration:</strong> ${req.duration}
    </div>

    <button class="accept" onclick="acceptRequest()">Accept Request</button>
    <button class="decline" onclick="declineRequest()">Decline</button>
  `;
}

function renderAssignment(assign) {
  content.innerHTML = `
    <div class="card">
      <strong>My Assignment</strong>
      <strong>Agent:</strong> ${assign.agentName}
      <strong>Address:</strong> ${assign.address}, ${assign.city}, ${assign.state} ${assign.zip}
      <strong>Date:</strong> ${assign.date}
      <strong>Time:</strong> ${assign.time}
      <strong>Duration:</strong> ${assign.duration}
    </div>

    <button class="start" onclick="startNavigation()">Start Assignment</button>
  `;
}

function acceptRequest() {
  if (!observerProfileComplete) {
    alert("You must complete your observer profile and agreement before accepting.");
    return;
  }

  const assignment = {
    ...openRequest,
    observerAccepted: true
  };

  localStorage.setItem("rg_active_assignment", JSON.stringify(assignment));
  localStorage.removeItem("rg_active_request");

  location.reload();
}

function declineRequest() {
  localStorage.removeItem("rg_active_request");
  location.reload();
}

function startNavigation() {
  const a = activeAssignment;
  const address = encodeURIComponent(
    `${a.address}, ${a.city}, ${a.state} ${a.zip}`
  );
  window.open(`https://www.google.com/maps/search/?api=1&query=${address}`, "_blank");
}

function logout() {
  localStorage.removeItem("rg_observer_logged_in");
  window.location.href = "observer-auth.html";
}
</script>

</body>
</html>
