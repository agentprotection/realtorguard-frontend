<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Agent Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#f4f4f4}
.wrap{max-width:650px;margin:auto;padding:16px}
.card{background:#fff;border-radius:14px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,.08);margin-top:14px}
button{width:100%;padding:14px;margin-top:14px;border:none;border-radius:12px;font-weight:900;background:#111;color:#fff}
.secondary{background:#fff;color:#111;border:1px solid #ccc}
.pill{padding:6px 10px;border-radius:999px;font-size:12px;font-weight:900;background:#eee}
.green{background:#e7ffe7;color:#145214}
</style>
</head>
<body>

<div class="wrap">
<h2>Request an Observer</h2>

<div class="card" id="form">
<input id="agentName" placeholder="Agent Name">
<div id="props"></div>
<button class="secondary" onclick="addProp()">Add Property</button>
<button onclick="submit()">Request Observer</button>
</div>

<div class="card" id="success" style="display:none">
<b>Your request is in the Observer Dashboard.</b>
<button class="secondary" onclick="reset()">Start New Request</button>
</div>

<div class="card">
<b>My Requests</b>
<button class="secondary" onclick="hardRefresh()">Refresh</button>
<div id="list"></div>
</div>
</div>

<script>
const REQ="rg_agent_requests_v1";
const STATUS="rg_request_status_v3";

const loadReq=()=>JSON.parse(localStorage.getItem(REQ))||[];
const loadStatus=()=>JSON.parse(localStorage.getItem(STATUS))||{};

function hardRefresh(){location.reload();}

function addProp(){
const d=document.createElement("div");
d.innerHTML=`
<input placeholder="Property Address">
<input type="date">
<input type="time">
`;
props.appendChild(d);
}

function submit(){
const agent=agentName.value.trim();
if(!agent)return alert("Agent name required");
const reqs=loadReq();
document.querySelectorAll("#props div").forEach((b,i)=>{
const [addr,date,time]=b.querySelectorAll("input");
if(addr.value&&date.value&&time.value){
reqs.push({
id:"req_"+Date.now()+"_"+i,
agentName:agent,
address:addr.value,
date:date.value,
time:time.value
});
}});
localStorage.setItem(REQ,JSON.stringify(reqs));
form.style.display="none";
success.style.display="block";
render();
}

function reset(){
agentName.value="";
props.innerHTML="";
form.style.display="block";
success.style.display="none";
}

function render(){
list.innerHTML="";
const reqs=loadReq().reverse();
const stat=loadStatus();
reqs.forEach(r=>{
const st=stat[r.id]?.status||"pending";
list.innerHTML+=`
<div class="card">
<b>${r.address}</b>
<div class="pill ${st==="accepted"?"green":""}">${st.toUpperCase()}</div>
</div>`;
});
}

addProp();
render();
</script>
</body>
</html>
