<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Agent Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f2f2f2;
    }

    .wrap {
      max-width: 900px;
      margin: auto;
      padding: 16px;
    }

    h2 {
      margin-bottom: 12px;
    }

    .card {
      background: #fff;
      padding: 16px;
      border-radius: 10px;
      margin-bottom: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    input, select, button {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      font-size: 16px;
    }

    button {
      cursor: pointer;
      font-weight: bold;
    }

    .primary {
      background: #111;
      color: #fff;
      border: none;
    }

    .secondary {
      background: #fff;
      border: 1px solid #ccc;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .status {
      font-weight: bold;
      margin-top: 6px;
    }

    .pending { color: #b78100; }
    .accepted { color: #2e7d32; }
    .expired { color: #b71c1c; }
    .cancelled { color: #555; }
  </style>
</head>

<body>
<div class="wrap">
  <h2>Agent Dashboard</h2>

  <!-- FORM -->
  <div class="card">
    <input id="address" placeholder="Property Address" />

    <div class="row">
      <select id="state"></select>
      <select id="timezone">
        <option value="ET">Eastern Time</option>
        <option value="CT">Central Time</option>
        <option value="MT">Mountain Time</option>
        <option value="PT">Pacific Time</option>
      </select>
    </div>

    <div class="row">
      <input type="date" id="date" />
      <select id="time"></select>
    </div>

    <button class="primary" onclick="submitRequest()">Submit</button>
  </div>

  <!-- ACTIONS -->
  <div class="card">
    <button class="secondary" onclick="render()">Refresh</button>
    <button class="secondary" onclick="deleteExpired()">Delete Expired</button>
  </div>

  <!-- REQUEST LIST -->
  <div id="requestList"></div>
</div>

<script>
const STATES = [
  "AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA",
  "HI","ID","IL","IN","IA","KS","KY","LA","ME","MD",
  "MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ",
  "NM","NY","NC","ND","OH","OK","OR","PA","RI","SC",
  "SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"
];

function init() {
  state.innerHTML = STATES.map(s => `<option>${s}</option>`).join("");

  time.innerHTML = "";
  for (let h = 8; h <= 18; h++) {
    ["00","30"].forEach(m => {
      const ampm = h >= 12 ? "PM" : "AM";
      const dh = h > 12 ? h - 12 : h;
      time.innerHTML += `<option>${dh}:${m} ${ampm}</option>`;
    });
  }
}

function getReqs() {
  return JSON.parse(localStorage.getItem("requests")) || [];
}

function saveReqs(r) {
  localStorage.setItem("requests", JSON.stringify(r));
}

function submitRequest() {
  const r = getReqs();
  r.push({
    address: address.value,
    state: state.value,
    timezone: timezone.value,
    date: date.value,
    time: time.value,
    status: "pending"
  });
  saveReqs(r);
  render();
}

function deleteExpired() {
  const now = new Date();
  const r = getReqs().filter(x => {
    const d = new Date(`${x.date} ${x.time}`);
    return d >= now;
  });
  saveReqs(r);
  render();
}

function render() {
  const list = document.getElementById("requestList");
  const r = getReqs();
  list.innerHTML = "";

  if (!r.length) {
    list.innerHTML = "<p>No requests</p>";
    return;
  }

  r.forEach((x, i) => {
    const expired = new Date(`${x.date} ${x.time}`) < new Date();
    if (x.status === "pending" && expired) x.status = "expired";

    list.innerHTML += `
      <div class="card">
        <strong>${x.address}</strong><br>
        ${x.state} · ${x.date} · ${x.time} · ${x.timezone}<br>
        <span class="status ${x.status}">
          ${x.status.toUpperCase()}
        </span>
      </div>
    `;
  });

  saveReqs(r);
}

init();
render();
</script>
</body>
</html>
