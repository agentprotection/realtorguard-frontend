<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Agent Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body { font-family: Arial; background: #f4f4f4; margin: 0; }
    .wrap { max-width: 900px; margin: auto; padding: 16px; }
    .card { background: #fff; padding: 16px; border-radius: 12px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,.08); }
    input, select, button { width: 100%; padding: 12px; margin-top: 8px; }
    button { font-weight: bold; cursor: pointer; }
    .primary { background: #111; color: #fff; }
    .secondary { background: #fff; border: 1px solid #ccc; }
    .pending { color: #b78100; }
    .accepted { color: #2e7d32; }
    .cancelled { color: #555; }
    .expired { color: #b71c1c; }
  </style>
</head>

<body>
<div class="wrap">
  <h2>Agent Dashboard</h2>

  <!-- REQUEST FORM -->
  <div class="card">
    <h3>Request Observer</h3>
    <input id="address" placeholder="Property Address" />
    <input type="date" id="date" />
    <select id="time"></select>
    <button class="primary" onclick="submitRequest()">Submit Request</button>
  </div>

  <h3>Your Requests</h3>
  <div id="requestList"></div>
</div>

<script>
function load() {
  const t = document.getElementById("time");
  t.innerHTML = "";
  for (let h = 8; h <= 18; h++) {
    ["00","30"].forEach(m => {
      const ampm = h >= 12 ? "PM" : "AM";
      const dh = h > 12 ? h - 12 : h;
      t.innerHTML += `<option>${dh}:${m} ${ampm}</option>`;
    });
  }
}

function getReqs() {
  return JSON.parse(localStorage.getItem("requests")) || [];
}

function saveReqs(r) {
  localStorage.setItem("requests", JSON.stringify(r));
}

function submitRequest() {
  const reqs = getReqs();
  reqs.push({
    address: address.value,
    date: date.value,
    time: time.value,
    status: "pending"
  });
  saveReqs(reqs);
  render();
}

function cancel(i) {
  const r = getReqs();
  r[i].status = "cancelled";
  saveReqs(r);
  render();
}

function del(i) {
  const r = getReqs();
  r.splice(i,1);
  saveReqs(r);
  render();
}

function render() {
  const list = document.getElementById("requestList");
  const r = getReqs();
  list.innerHTML = "";

  if (!r.length) {
    list.innerHTML = "<p>No requests</p>";
    return;
  }

  r.forEach((x,i) => {
    const expired = new Date(`${x.date} ${x.time}`) < new Date();
    if (x.status === "pending" && expired) x.status = "expired";

    list.innerHTML += `
      <div class="card">
        <strong>${x.address}</strong><br>
        ${x.date} ${x.time}<br>
        <span class="${x.status}">${x.status.toUpperCase()}</span>

        ${x.status === "pending"
          ? `<button class="secondary" onclick="cancel(${i})">Cancel</button>`
          : ""}

        <button class="secondary" onclick="del(${i})">Delete</button>
      </div>`;
  });

  saveReqs(r);
}

load();
render();
</script>
</body>
</html>
